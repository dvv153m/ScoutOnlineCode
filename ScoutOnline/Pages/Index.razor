@page "/"
@using System.Drawing
@using BlazorLeaflet.Models
@inject IJSRuntime jsRuntime

<label style="margin-left:20px">Карта:</label>
<select name="example" @onchange="ChangeMap">
    <option value="OpenStreetMap">OpenStreetMap(OSM)</option>
    <option value="Yandex">Yandex</option>
    <option value="YandexSatellite">Yandex Спутник</option>
    <option value="Google">Google</option>
    <option value="GoogleHybrid">Google Гибрид</option>
    <option value="GoogleSatellite">Google Спутник</option>
</select>
<div id="mapContainer" style="margin-top:10px; width: 100%; height: 90vh;">
    <LeafletMap Map="_map" />
</div>

@code{

    private Map _map;

    private LatLng _startAt = new LatLng(59.948080f, 30.326621f);

    private TileLayer CurrentLayer;

    private void ChangeMap(ChangeEventArgs arg)
    {
        var mapType = arg.Value.ToString();
        _map.RemoveLayer(CurrentLayer);

        if (mapType == "OpenStreetMap")
        {
            CurrentLayer = new TileLayer
            {
                UrlTemplate = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
                Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors"
            };
        }
        else if (mapType == "Yandex")
        {
            CurrentLayer = new TileLayer
            {
                UrlTemplate = "https://vec{s}.maps.yandex.net/tiles?l=map&v=17.03.30-0&z={z}&x={x}&y={y}&scale=2",
                Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
                Subdomains = new string[] { "01", "02", "03", "04" }
            };
        }        
        else if (mapType == "YandexSatellite")
        {
            CurrentLayer = new TileLayer
            {
                UrlTemplate = "https://sat{s}.maps.yandex.net/tiles?l=sat&v=3.307.0&x={x}&y={y}&z={z}",
                Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
                Subdomains = new string[] { "01", "02", "03", "04" }
            };
        }
        else if (mapType == "Google")
        {
            CurrentLayer = new TileLayer
            {
                UrlTemplate = "https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",
                Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
                Subdomains = new string[] { "mt0", "mt1", "mt2", "mt3" }
            };
        }
        else if (mapType == "GoogleHybrid")
        {
            CurrentLayer = new TileLayer
            {
                UrlTemplate = "https://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}",
                Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
                Subdomains = new string[] { "mt0", "mt1", "mt2", "mt3" }
            };
        }
        else if (mapType == "GoogleSatellite")
        {
            CurrentLayer = new TileLayer
            {
                UrlTemplate = "https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}",
                Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
                Subdomains = new string[] { "mt0", "mt1", "mt2", "mt3" }
            };
        }
        else
        {
            return;
        }

        _map.AddLayer(CurrentLayer);
    }

    protected override void OnInitialized()
    {
        _map = new Map(jsRuntime)
        {
            Center = _startAt,
            Zoom = 7.8f
        };

        CurrentLayer = new TileLayer
        {
            UrlTemplate = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            Attribution = "&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors",
        };

        _map.OnInitialized += () =>
        {
            _map.AddLayer(CurrentLayer);
        };
    }
}
